<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PaleZine – Volume 1</title>

<style>
  body {
    margin: 0;
    background: radial-gradient(circle at 20% 20%, #2a2a2a 0%, #000 80%);
    font-family: system-ui, sans-serif;
    color: #fff;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;

    cursor: url("camel_cursor.ong") 4 4, auto;
  }

  header {
    position: sticky; top: 0;
    width: 100%;
    padding: .75rem;
    background: rgba(0,0,0,0.6);
    border-bottom: 1px solid rgba(255,255,255,0.1);
    display: flex; justify-content: center; gap: 1rem;
  }

  .btn {
    padding: .45rem .7rem;
    border-radius: 8px;
    background: rgba(255,255,255,0.1);
    border: 1px solid rgba(255,255,255,0.15);
    color: white;
    text-decoration: none;
    cursor: inherit;
  }

  .wrap { max-width: 900px; width: 100%; padding: 1rem; }

  #scrollReader img {
    width: 100%;
    margin-bottom: .75rem;
    border-radius: 10px;
    background: #111;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
  }

  #flipbook {
    width: 900px;
    height: 600px;
    background: #111;
    border-radius: 12px;
    overflow: hidden;
    display: none;
    position: relative;
    margin: auto;
  }

  .page {
    width: 450px;
    height: 600px;
    background-size: cover;
    background-position: center;
    position: relative;
  }

  /* ⭐ Small floating arrow indicator */
  #flipArrow {
    position: absolute;
    top: 8px;
    right: 8px;
    font-size: 16px;
    opacity: 0.7;
    pointer-events: none;
    z-index: 9999;
    display: none;
  }

  @media (max-width:950px){
    #flipbook { width:100%; height:calc(100vw*(600/900)); }
    .page { width:50%; height:100%; }
  }
</style>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/blasten/turn.js/turn.min.js"></script>

</head>
<body>

<header>
  <span>PaleZine — Volume 1</span>
  <button id="toggleMode" class="btn">Switch to Flip</button>
  <a href="booklet.pdf" class="btn" download>Download PDF</a>
  <a href="index.html" class="btn">Back</a>
</header>

<div class="wrap">
  <div id="flipArrow">↱</div>
  <div id="scrollReader"></div>
  <div id="flipbook"></div>
</div>

<script>
const folder="pages/";
const prefix="booklet-page-";
const ext=".jpg";
const pad=3;
const max=200;

let pages=[];
let mode="scroll";

function padNum(n){ return String(n).padStart(pad,"0"); }

async function discover(){
  const arr=[];
  for(let i=1;i<max;i++){
    const url=`${folder}${prefix}${padNum(i)}${ext}`;
    const img=new Image();
    img.src=url;
    const ok = await new Promise(res=>{img.onload=()=>res(true); img.onerror=()=>res(false);});
    if(!ok) break;
    arr.push(url);
  }
  return arr;
}

function showScroll(){
  document.getElementById("flipArrow").style.display="none";
  const s=document.getElementById("scrollReader");
  const f=document.getElementById("flipbook");

  s.innerHTML="";
  pages.forEach(src=>{
    const im=document.createElement("img");
    im.src=src;
    s.appendChild(im);
  });

  s.style.display="block";
  f.style.display="none";
  mode="scroll";
  toggleMode.textContent="Switch to Flip";
}

function showFlip(){
  const s=document.getElementById("scrollReader");
  const f=document.getElementById("flipbook");

  s.style.display="none";
  f.innerHTML="";

  pages.forEach(src=>{
    const p=document.createElement("div");
    p.className="page";
    p.style.backgroundImage=`url(${src})`;
    f.appendChild(p);
  });

  f.style.display="block";

  const fb=$("#flipbook");
  try{ if(fb.data("init")) fb.turn("destroy"); }catch(e){}

  fb.turn({
    width:900,
    height:600,
    autoCenter:true,
    display: window.innerWidth < 950 ? "single" : "double",
    when: {
      turning: function(){
        document.getElementById("flipArrow").style.display="none";
      }
    }
  });

  fb.data("init",true);

  /* Show arrow indicator only on page 1 */
  document.getElementById("flipArrow").style.display="block";

  mode="flip";
  toggleMode.textContent="Switch to Scroll";
}

toggleMode.addEventListener("click",()=>{
  if(mode==="scroll") showFlip();
  else showScroll();
});

(async function(){
  pages = await discover();
  showScroll();
})();
</script>

</body>
</html>
